# Streamlit実装プラン v2.0 - Note有料記事検索ツール

## v2.0の主な変更点

### 検索演算子機能の追加
- **検索モード選択**: 通常/AND/OR/NOT/カスタム検索の5モード
- **動的UI**: 選択したモードに応じて入力フォームが変化
- **検索クエリプレビュー**: 実際のAPIクエリをリアルタイム表示
- **除外ワード統合**: NOT検索モードでAPI側除外処理

### UI/UXの改善
- **シンプルな設計**: 除外ワード設定セクションを削除
- **役割明確化**: 各検索モードの使い分けを明確に
- **ガイド強化**: 検索演算子の説明と使用例を追加

## 画面構成

### メインページレイアウト
```
┌─────────────────────────────────────────────┐
│  📰 Note有料記事検索ツール                      │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │
│                                              │
│  🔍 検索設定                                  │
│  検索モード: [通常] [AND] [OR] [NOT] [カスタム] │
│                                              │
│  検索キーワード: [_______________]            │
│                                              │
│  [▼ 詳細設定]                                │
│  ┌─────────────────────────────────────────────┐│
│  │ 取得ページ数: [1---------10--------20]   ││
│  │ 価格上限: [5000] 円                     ││
│  │ 最低いいね数: [0]                       ││
│  └─────────────────────────────────────────────┘│
│                                              │
│  🔎 検索クエリ: `エッセイ AND 旅行`             │
│                                              │
│  [🔍 検索実行]                               │
│                                              │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │
│  検索結果 (123件)              [📥 CSV保存]   │
│  ┌─────┬──────┬──────────────┬──────┬──────┬──────┐│
│  │いいね│ 価格  │ タイトル      │著者  │公開日 │リンク││
│  ├─────┼──────┼──────────────┼──────┼──────┼──────┤│
│  │ 523 │￥1000│エッセイ...    │user1 │01/20 │[記事]││
│  │ 412 │ ￥500│創作ノート...  │user2 │01/19 │[記事]││
│  └─────┴──────┴──────────────┴──────┴──────┴──────┘│
└─────────────────────────────────────────────┘
```

### サイドバー構成
- 使い方ガイド（検索演算子の説明を含む）
- 注意事項
- トラブルシューティング

## 実装フェーズ

### Phase 1: 基本機能実装（MVP）
**目標**: 最小限の検索・表示機能

1. **プロジェクト構成**
   ```
   note-like/
   ├── app.py              # メインアプリ
   ├── requirements.txt    # 依存関係
   ├── .gitignore
   ├── README.md
   └── document/           # 仕様書類
       ├── note_paid_articles_collection_spec_v2.md
       └── streamlit_implementation_plan_v2.md
   ```

2. **基本UI実装**
   - 検索モード選択（通常検索のみ）
   - 検索キーワード入力
   - 検索実行ボタン
   - 結果表示テーブル（リンク列含む）

3. **API連携**
   - note API呼び出し（基本的なエラーハンドリング）
   - レート制限対応（800-1200ms待機）
   - 10ページ固定取得

4. **データ処理**
   - 有料記事フィルタリング
   - いいね数ソート
   - URL構築とリンク列作成

### Phase 2: 検索演算子機能実装
**目標**: 高度な検索機能の提供

1. **検索モード実装**
   - AND/OR/NOT/カスタム検索モード
   - 各モードに対応した動的UI
   - 検索クエリのプレビュー表示

2. **詳細設定UI**
   - エキスパンダーによる詳細設定表示
   - スライダー、数値入力の実装
   - 価格上限、最低いいね数設定

3. **検索演算子処理**
   - APIレベルでの演算子処理
   - 複合クエリのサポート
   - エラーハンドリング

### Phase 3: UX改善
**目標**: 使いやすさの向上

1. **進捗表示**
   - プログレスバー
   - 取得中メッセージ
   - 取得済み件数表示

2. **エラーハンドリング改善**
   - ユーザーフレンドリーなエラーメッセージ
   - 部分的な結果の表示
   - リトライ機能

3. **結果表示改善**
   - クリック可能なリンク列
   - CSV出力にURL列を含める
   - ソート機能の向上

### Phase 4: ガイド・ドキュメント強化
**目標**: ユーザビリティの向上

1. **使い方ガイド**
   - 検索演算子の詳細説明
   - 具体的な使用例
   - トラブルシューティング

2. **画面内ヘルプ**
   - 各機能のヘルプテキスト
   - プレースホルダーでの例示
   - インタラクティブなガイド

### Phase 5: デプロイ準備
**目標**: Streamlit Cloudでの公開

1. **環境変数対応**
   - st.secrets対応
   - 設定の外部化

2. **パフォーマンス最適化**
   - セッション状態の活用
   - キャッシュ実装（@st.cache_data）

3. **デプロイ設定**
   - GitHub連携
   - Streamlit Cloud設定
   - 使用ガイド作成

## 技術スタック

### 必須ライブラリ
```txt
streamlit==1.28.0
requests==2.31.0
pandas==2.1.0
python-dateutil==2.8.2
```

### 新機能で使用するライブラリ
- streamlit.radio: 検索モード選択
- streamlit.columns: 複数キーワード入力
- streamlit.text_area: カスタム検索クエリ入力
- streamlit.info: 検索クエリプレビュー
- streamlit.column_config.LinkColumn: クリック可能リンク

### 開発環境
- Python 3.9+
- Git/GitHub
- VSCode推奨

## 検索演算子の技術仕様

### 対応演算子
- `AND` (大文字・小文字対応): 複数条件をすべて満たす
- `OR` (大文字・小文字対応): 複数条件のいずれかを満たす  
- `NOT` (大文字・小文字対応): 特定条件を除外
- `()` (括弧): 演算子の優先度を制御

### 検索モード別クエリ生成
```python
# 通常検索
query = keyword

# AND検索
query = f"{keyword1} AND {keyword2}"

# OR検索  
query = f"{keyword1} OR {keyword2}"

# NOT検索
query = f"{main_keyword} NOT {exclude1} NOT {exclude2}"

# カスタム検索
query = custom_input  # ユーザー入力をそのまま使用
```

### エラーハンドリング
- 400 Bad Request: ユーザーにエラーメッセージ表示
- 403/429: バックオフで再試行
- 5xx: 指数バックオフで再試行
- 無効なクエリ: 入力チェックとガイダンス

## セキュリティ・コンプライアンス

1. **レート制限遵守**
   - 800-1200msのランダム待機
   - 429エラー時の自動バックオフ

2. **エラー情報の取り扱い**
   - APIキーなどの秘密情報は扱わない
   - エラーログに個人情報を含めない

3. **利用規約の表示**
   - 個人利用限定の注意書き
   - note利用規約へのリンク

## テスト計画

### 単体テスト
- 検索クエリ生成関数
- 検索演算子パースング
- フィルター処理
- データ変換

### 統合テスト  
- 各検索モードの動作確認
- エンドツーエンドの検索フロー
- エラー時の挙動
- CSV出力（URL列含む）

### ユーザビリティテスト
- 各検索モードの使いやすさ
- 検索クエリプレビューの理解度
- エラーメッセージの理解度
- 検索演算子ガイドの効果

## v1.0からの移行

### 削除された機能
- フィルタープリセット（ゆるめ/標準/厳しめ/カスタム）
- 除外ワード設定セクション

### 新機能
- 検索モード選択
- 検索演算子（AND/OR/NOT/複合）
- 検索クエリプレビュー
- クリック可能リンク列
- CSV出力にURL列

### 移行時の注意点
- 既存ユーザーへの新機能説明
- 従来の除外ワード機能をNOT検索で代替
- ガイドの更新とユーザー教育